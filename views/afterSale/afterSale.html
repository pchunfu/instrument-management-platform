<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>售后服务系统</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <link rel="stylesheet" href="../../assets/libs/layui/css/layui.css" />
    <link rel="stylesheet" href="../../assets/module/admin.css?v=318" />
    <script type="text/javascript" src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <script type="text/javascript" src="../../assets/libs/layui/layui.js"></script>
    <script type="text/javascript" src="../../assets/js/common.js?v=318"></script>
    <script type="text/javascript" src="../../assets/js/util.js?v=318"></script>
    <script type="text/javascript" src="../../assets/js/url.js?v=318"></script>
    <script type="text/javascript" src="../../assets/js/htmlUtil.js?v=318"></script>
    <style>
        ul {
            position: absolute;
            top: 20px;
            right: 15px;
        }
        
        ul li {
            display: block;
            float: left;
            margin-left: 40px;
        }
        
        .layui-textarea {
            resize: none;
        }
        
        body .layerdemo .layui-layer-title {
            color: rgb(16, 16, 17);
            background-color: rgb(242, 248, 248);
        }
        
        .layui-table-tool-panel {
            min-width: 120px;
        }
        
        .layui-table-tool-panel li {
            margin-left: auto;
        }
    </style>
</head>

<body>
    <div class="layui-fluid">
        <div class="layui-card">
            <div class="layui-card-body">
                <form class="layui-form" action="">
                    <div class="layui-form-item" style="margin-top: 10px;">
                        <div class="layui-inline" style="width: 20%;">
                            <label class="layui-form-label" style="width: 60px;">服务主题</label>
                            <div class="layui-input-inline" style="width: 50%;">
                                <select id="serviceTopicId" lay-search="" name="serviceTopicId">
									<option value="">请选择</option>
									<option value="1">安装服务</option>
									<option value="2">维护服务</option>
								</select>
                            </div>
                        </div>
                        <div class="layui-inline" style="width: 20%;">
                            <label class="layui-form-label" style="width: 60px;">服务分类</label>
                            <div class="layui-input-inline" style="width: 50%;">
                                <select id="serviceMainCategoryId" lay-search="" name="serviceMainCategoryId">
									<option value="">请选择</option>
									<option value="1">应用问题</option>
									<option value="2">产品问题</option>
								</select>
                            </div>
                        </div>
                        <div class="layui-inline" style="width: 20%;">
                            <label class="layui-form-label" style="width: 60px;">处理状态</label>
                            <div class="layui-input-inline" style="width: 50%;">
                                <select id="processingStatus" lay-search="" name="processingStatus">
									<option value="">请选择</option>
									<option value="1">未处理</option>
									<option value="2">处理中</option>
									<option value="3">已完成</option>
								</select>
                            </div>
                        </div>
                        <div class="layui-inline" style="width: 20%;">
                            <label class="layui-form-label" style="width: 60px;">客户</label>
                            <div class="layui-input-inline" style="width: 50%;">
                                <select id="customerId" lay-search="" name="customerId">
									<option value="">请选择</option>
								</select>
                            </div>
                        </div>
                        <div class="layui-inline" style="width: 20%;">
                            <label class="layui-form-label" style="width: 60px;">处理人员</label>
                            <div class="layui-input-inline" style="width: 50%;">
                                <select id="processing" lay-search="" name="processing" lay-filter="processing">
								  <option value="">请选择</option>
								</select>
                            </div>
                        </div>
                        <div class="layui-inline">
                            <label class="layui-form-label" style="width: 60px;">服务时间</label>
                            <div class="layui-input-inline" style="width: 200px;">
                                <input name="loginRecordDateSel" class="layui-input icon-date" style="width: 200px;" placeholder="选择日期范围" autocomplete="off" />
                            </div>
                        </div>
                        <ul style="display: block; float: right;">
                            <li>
                                <button id="137" class="layui-btn icon-btn query" lay-filter="Search" lay-submit data-type="reload"><i class="layui-icon">&#xe615;</i>搜索
							        </button>
                            </li>
                            <li>
                                <button type="reset" class="layui-btn layui-btn-normal" id="chongzhi">重置</button>
                            </li>
                        </ul>
                    </div>
                </form>
                <table id="afterSaleTable" class="layui-hide" lay-filter="test">
                </table>
            </div>
        </div>
    </div>
    <!-- 表格头按钮操作 -->
    <script type="text/html" id="add">
        {{# var storage = window.localStorage; var data = storage.getItem('userData'); var userData = JSON.parse(data); var l_ist = userData.permissionId;}} {{# for(var i = 0;i
        < l_ist.length;i ++){ }} {{# if(l_ist[i]=='138' ){ }}<a class="layui-btn layui-btn-sm" lay-event="add">添加</a> {{# } } }}
    </script>
    <!-- 表格按钮操作 -->
    <script type="text/html" id="barDemo">
        {{# var storage = window.localStorage; var data = storage.getItem('userData'); var userData = JSON.parse(data); var l_ist = userData.permissionId;}} {{# for(var i = 0;i
        < l_ist.length;i ++){ }} {{# if(l_ist[i]=='139' && d.processingStatus=="未处理" ){ }} <a class="layui-btn-xs" lay-event="start" title="开始服务"><i class="layui-icon layui-icon-time"></i></a> {{# } }} {{# if(l_ist[i]=='141' && d.processingStatus == "未处理" ){ }} <a class="layui-btn-xs" lay-event="edit" title="编辑"><i class="layui-icon layui-icon-edit"></i></a> {{# } }} {{# if(l_ist[i]=='140'
            && d.processingStatus == "处理中" ){ }} <a class="layui-btn-xs" lay-event="over" title="结束服务"><i class="layui-icon layui-icon-logout"></i></a> {{# } }} {{# if(l_ist[i]=='141' && d.processingStatus == "处理中" ){ }} <a class="layui-btn-xs" lay-event="edit"
                title="编辑"><i class="layui-icon layui-icon-edit"></i></a> {{# } }} {{# if(l_ist[i]=='142' && d.processingStatus == "已完成"){ }} <a class="layui-btn-xs" lay-event="detail" title="查看"><i class="layui-icon layui-icon-search"></i></a> {{# } }} {{#
            if(l_ist[i]=='142' && d.processingStatus == "处理中"){ }} <a class="layui-btn-xs" lay-event="detail" title="查看"><i class="layui-icon layui-icon-search"></i></a> {{# } }} {{# if(l_ist[i]=='142' && d.processingStatus == "未处理"){ }} <a class="layui-btn-xs"
                lay-event="detail" title="查看"><i class="layui-icon layui-icon-search"></i></a> {{# } }} {{# if(l_ist[i]=='143' && d.processingStatus == "已完成" ){ }}
            <a class="layui-btn-xs" lay-event="del" title="删除"><i class="layui-icon layui-icon-delete"></i></a> {{# } }} {{# if(l_ist[i]=='143' && d.processingStatus == "处理中" ){ }}
            <a class="layui-btn-xs" lay-event="del" title="删除"><i class="layui-icon layui-icon-delete"></i></a> {{# } }} {{# if(l_ist[i]=='143' && d.processingStatus == "未处理" ){ }}
            <a class="layui-btn-xs" lay-event="del" title="删除"><i class="layui-icon layui-icon-delete"></i></a> {{# } }} {{# } }}
    </script>

    <script>
        var storage = window.localStorage;
        var data = storage.getItem('userData');
        var userData = JSON.parse(data);
        var json = storage.getItem('auth');
        var authData = JSON.parse(json);
        //用户权限判断
        $('#137').hide();
        var l_ist = userData.permissionId;
        for (var i = 0; i < l_ist.length; i++) {
            var item = l_ist[i];
            if (l_ist[i] == 137) {
                $('#137').show();
            }

        }
        layui.use(['form', 'layedit', 'laydate', 'layer', 'table', 'element', 'admin', 'upload'], function() {
            var form = layui.form;
            var element = layui.element;
            var layer = layui.layer;
            var layedit = layui.layedit;
            var laydate = layui.laydate;
            var table = layui.table;
            $ = layui.jquery;
            $form = $('form');
            var admin = layui.admin;
            // 获取本地缓存
            var storage = window.localStorage;
            var userData = storage.getItem('userData');
            userData = JSON.parse(userData);
            var userId = userData.userId;
            let operatorId = userId;
            /* 渲染时间选择 */
            laydate.render({
                elem: 'input[name="loginRecordDateSel"]',
                type: 'date',
                range: true,
                trigger: 'click'

            });
            //监听Tab切换
            element.on('tab(demo)', function(data) {
                layer.tips('切换了 ' + data.index + '：' + this.innerHTML, this, {
                    tips: 1
                });
            });
            // 正则验证
            form.verify({
                    phone: function(value, item) {
                        if (!new RegExp("^[a-zA-Z0-9_\u4e00-\u9fa5\\s·]+$").test(value)) {
                            return '不能有特殊字符';
                        }
                        if (/(^\_)|(\__)|(\_+$)/.test(value)) {
                            return '首尾不能出现下划线\'_\'';
                        }
                        if (!/^1[34578]\d{9}$/.test(value)) {
                            return '手机号码1[3-8]xxxxxxxxx';
                        }
                        if (!/^.{1,11}$/.test(value)) {
                            return '联系电话最多输入11位';
                        }
                        if (!/^[^\s]*$/.test(value)) {
                            return '不能输入空格哦!';
                        }
                    },
                    contacts: function(value) {
                        if (!new RegExp("^[a-zA-Z0-9_\u4e00-\u9fa5\\s·]+$").test(value)) {
                            return '不能有特殊字符';
                        }
                        if (/(^\_)|(\__)|(\_+$)/.test(value)) {
                            return '不能出现下划线\'_\'';
                        }
                        if (!/^[^\s]*$/.test(value)) {
                            return '不能输入空格哦!';
                        }
                        if (!/^.{1,10}$/.test(value)) {
                            return '最多10位哦!';
                        }
                    }
                })
                //表格渲染
            table.render({
                elem: '#afterSaleTable',
                id: 'afterSaleTable',
                title: '售后服务表',
                toolbar: '#add',
                async: true,
                page: true,
                sort: false,
                even: true,
                loading: true,
                contentType: "application/json",
                url: selectAfterSalesInformationUrl(),
                method: 'post',
                where: {
                    "afterSaleServiceTopic": '',
                    "afterSaleServiceCategory": '',
                    "processingStatus": '',
                    "customerId": '',
                    "serviceProcessingPersonnelId": '',
                    "serviceStartTime": '',
                    "serviceEndTime;": ''
                },
                defaultToolbar: ['filter', 'print', {
                    title: '导出',
                    layEvent: 'DIY_EXPORT',
                    icon: 'layui-icon-export'
                }],
                parseData: function(res) {
                    for (var i = 0; i < res.data.length; i++) {
                        var item = res.data[i];
                        if (res.data[i].afterSaleServiceTopic == 1) {
                            res.data[i].afterSaleServiceTopic = "安装服务"
                        } else {
                            res.data[i].afterSaleServiceTopic = "维护服务"
                        }
                        if (res.data[i].afterSaleServiceCategory == 1) {
                            res.data[i].afterSaleServiceCategory = "应用问题"
                        } else {
                            res.data[i].afterSaleServiceCategory = "产品问题"
                        }
                        if (res.data[i].processingStatus == 1) {
                            res.data[i].processingStatus = "未处理"
                        } else if (res.data[i].processingStatus == 2) {
                            res.data[i].processingStatus = "处理中"
                        } else {
                            res.data[i].processingStatus = "已完成"
                        }
                    }
                    if (res.data.length == 0) {
                        $(".layui-table-sort").remove();
                        return {
                            "code": 201,
                            "msg": '无数据',
                        };
                    }
                },
                cols: [
                    [{
                        type: 'checkbox',
                        fixed: 'left'
                    }, {
                        field: 'id',
                        title: '编号',
                        width: "7%",
                        align: 'center',
                        unresize: true,
                        sort: true
                    }, {
                        field: 'afterSaleServiceTopic',
                        title: '服务主题',
                        width: "9%",
                        align: 'center',
                        unresize: true
                    }, {
                        field: 'afterSaleServiceCategory',
                        title: '服务分类',
                        width: "9%",
                        align: 'center',
                        unresize: true
                    }, {
                        field: 'processingStatus',
                        title: '处理状态',
                        width: "9%",
                        align: 'center',
                        unresize: true
                    }, {
                        field: 'customerName',
                        title: '客户',
                        width: '7%',
                        align: 'center',
                        unresize: true
                    }, {
                        field: 'userName',
                        title: '处理人员',
                        width: "9%",
                        align: 'center',
                        unresize: true
                    }, {
                        field: 'chargeAmount',
                        title: '收费金额',
                        width: '9%',
                        align: 'center',
                        unresize: true
                    }, {
                        field: 'serviceStartTime',
                        title: '服务开始',
                        width: '9%',
                        align: 'center',
                        unresize: true
                    }, {
                        field: 'serviceEndTime',
                        title: '服务结束',
                        width: '9%',
                        align: 'center',
                        unresize: true
                    }, {
                        field: 'creationTime',
                        title: '创建日期',
                        width: "10%",
                        align: 'center',
                        unresize: true
                    }, {
                        fixed: 'right',
                        title: '操作',
                        toolbar: '#barDemo',
                        width: "14%",
                        align: 'center',
                        unresize: true
                    }]
                ],
            });
            //  表格头添加
            table.on('toolbar(test)', function(obj) {
                var checkStatus = table.checkStatus(obj.config.id),
                    data = checkStatus.data;
                switch (obj.event) {
                    case 'add':
                        layer.open({
                            type: 2,
                            title: '添加服务',
                            skin: 'layui-layer-rim',
                            area: ['600px', '350px'],
                            offset: 'auto',
                            maxmin: false,
                            skin: 'layerdemo',
                            resize: false,
                            content: ["./addAfterSales.html", 'no'],
                            success: function(layero, index) {
                                var data = obj.data;
                                var iframe = window['layui-layer-iframe' + index];
                                iframe.child(data);
                                layer.style(index, {
                                    top: (layui.$(window).height() - layui.$(layero).height()) / 2
                                })
                            },
                            end: function() {
                                table.reload("afterSaleTable", {
                                    page: {
                                        curr: $("#afterSaleTable .layui-laypage-em").next().html()
                                    },
                                    url: selectAfterSalesInformationUrl(),
                                    method: "post",
                                    contentType: 'application/json; charset=utf-8',
                                    where: {
                                        isPage: true
                                    },
                                    done: function(res, curr, count) {}
                                });
                            }
                        });
                        break;
                    case 'DIY_EXPORT':
                        if (data.length <= 0) {
                            alert("请选择至少一条记录进行导出");
                        } else {
                            table.exportFile(obj.config.id, data, 'xls');
                        }
                        break;
                };
            });
            //搜索功能
            form.on('submit(Search)', function(data) {
                if (data.field.loginRecordDateSel) {
                    var searchDate = data.field.loginRecordDateSel.split(' - ');
                    data.field.startDate = searchDate[0];
                    data.field.endDate = searchDate[1];
                } else {
                    data.field.startDate = '';
                    data.field.endDate = '';
                }
                table.reload("afterSaleTable", {
                    page: {
                        curr: 1
                    },
                    url: selectAfterSalesInformationUrl(),
                    method: "post",
                    contentType: 'application/json; charset=utf-8',
                    where: {
                        "afterSaleServiceTopic": data.field.serviceTopicId,
                        "afterSaleServiceCategory": data.field.serviceMainCategoryId,
                        "processingStatus": data.field.processingStatus,
                        "customerId": data.field.customerId,
                        "serviceProcessingPersonnelId": data.field.processing,
                        "serviceStartTime": data.field.startDate,
                        "serviceEndTime": data.field.endDate,
                    },
                    done: function(res, curr, count) {}
                });
                return false;
            });
            var area = [];
            if (window.screen.width > 1360 && window.screen.width < 1920) {
                area = ['70%', '450px'];
            } else if (window.screen.width >= 1920) {
                area = ['70%', '700px'];
            }
            /* 修改，开始，结束，查看详情，删除按钮点击事件 */
            table.on('tool(test)', function(obj) {
                if (obj.event === 'edit' && obj.data.processingStatus == "未处理") {
                    layer.open({
                        type: 2,
                        title: "修改服务",
                        skin: 'layui-layer-rim',
                        area: ['600px', '380px'],
                        offset: 'auto',
                        skin: 'layerdemo',
                        resize: false,
                        content: "./editorstartAfterSale.html",
                        success: function(layero, index) {
                            var data = obj.data;
                            var iframe = window['layui-layer-iframe' + index];
                            iframe.child(data);
                            var roleId = layer.getChildFrame("#afterSaleServiceCategory", index);
                            roleId.val(obj.data.afterSaleServiceCategory);
                            var roleId = layer.getChildFrame("#afterSaleServiceTopic", index);
                            roleId.val(obj.data.afterSaleServiceTopic);
                            var roleId = layer.getChildFrame("#departmentName", index);
                            roleId.val(obj.data.departmentName);
                            var roleId = layer.getChildFrame("#productName", index);
                            roleId.val(obj.data.productName);
                            var roleId = layer.getChildFrame("#customerName", index);
                            roleId.val(obj.data.customerName);
                            var roleId = layer.getChildFrame("#userName", index);
                            roleId.val(obj.data.userName);
                            var roleId = layer.getChildFrame("#contacts", index);
                            roleId.val(obj.data.contacts);
                            var roleId = layer.getChildFrame("#contactNum", index);
                            roleId.val(obj.data.contactNum);
                        },
                        end: function() {
                            table.reload("afterSaleTable", {
                                page: {
                                    curr: $("#afterSaleTable .layui-laypage-em").next().html()
                                },
                                url: selectAfterSalesInformationUrl(),
                                method: "post",
                                contentType: 'application/json; charset=utf-8',
                                where: {
                                    isPage: true
                                },
                                done: function(res, curr, count) {}
                            });
                        }
                    });
                } else if (obj.event === 'edit' && obj.data.processingStatus == "处理中") {
                    layer.open({
                        type: 2,
                        title: "修改服务",
                        skin: 'layui-layer-rim',
                        area: ['60%', '300px'],
                        offset: 'auto',
                        skin: 'layerdemo',
                        resize: false,
                        content: "./editorAfterSale.html",
                        success: function(layero, index) {
                            var data = obj.data;
                            var iframe = window['layui-layer-iframe' + index];
                            iframe.child(data);
                            var roleId = layer.getChildFrame("#contacts", index);
                            roleId.val(obj.data.contacts);
                            var roleId = layer.getChildFrame("#contactNum", index);
                            roleId.val(obj.data.contactNum);
                            var roleId = layer.getChildFrame("#chargeAmount", index);
                            roleId.val(obj.data.chargeAmount);
                            var roleId = layer.getChildFrame("#hotelExpense", index);
                            roleId.val(obj.data.hotelExpense);
                            var roleId = layer.getChildFrame("#subsidyFee", index);
                            roleId.val(obj.data.subsidyFee);
                            var roleId = layer.getChildFrame("#travelExpenses", index);
                            roleId.val(obj.data.travelExpenses);
                            var roleId = layer.getChildFrame("#serviceStartTime", index);
                            roleId.val(obj.data.serviceStartTime);
                            var roleId = layer.getChildFrame("#serviceEndTime", index);
                            roleId.val(obj.data.serviceEndTime);
                            var roleId = layer.getChildFrame("#serviceContent", index);
                            roleId.val(obj.data.serviceContent);
                            var roleId = layer.getChildFrame("#serviceDescription", index);
                            roleId.val(obj.data.serviceDescription);
                        },
                        end: function() {
                            table.reload("afterSaleTable", {
                                page: {
                                    curr: $("#afterSaleTable .layui-laypage-em").next().html()
                                },
                                url: selectAfterSalesInformationUrl(),
                                method: "post",
                                contentType: 'application/json; charset=utf-8',
                                where: {
                                    isPage: true
                                },
                                done: function(res, curr, count) {}
                            });
                        }
                    });
                } else if (obj.event === 'start') {
                    layer.open({
                        type: 2,
                        title: "开始服务",
                        skin: 'layui-layer-rim',
                        area: ['800px', '370px'],
                        offset: 'auto',
                        skin: 'layerdemo',
                        resize: false,
                        content: "./startAfterSale.html",
                        success: function(layero, index) {
                            var data = obj.data;
                            var iframe = window['layui-layer-iframe' + index];
                            iframe.child(data);
                            var roleId = layer.getChildFrame("#afterSaleServiceCategory", index);
                            roleId.val(obj.data.afterSaleServiceCategory);
                            var roleId = layer.getChildFrame("#afterSaleServiceTopic", index);
                            roleId.val(obj.data.afterSaleServiceTopic);
                            var roleId = layer.getChildFrame("#departmentName", index);
                            roleId.val(obj.data.departmentName);
                            var roleId = layer.getChildFrame("#productName", index);
                            roleId.val(obj.data.productName);
                            var roleId = layer.getChildFrame("#customerName", index);
                            roleId.val(obj.data.customerName);
                            var roleId = layer.getChildFrame("#userName", index);
                            roleId.val(obj.data.userName);
                            var roleId = layer.getChildFrame("#contacts", index);
                            roleId.val(obj.data.contacts);
                            var roleId = layer.getChildFrame("#contactNum", index);
                            roleId.val(obj.data.contactNum);
                        },
                        end: function() {
                            table.reload("afterSaleTable", {
                                page: {
                                    curr: $("#afterSaleTable .layui-laypage-em").next().html()
                                },
                                url: selectAfterSalesInformationUrl(),
                                method: "post",
                                contentType: 'application/json; charset=utf-8',
                                where: {
                                    isPage: true
                                },
                                done: function(res, curr, count) {}
                            });
                        }
                    });
                } else if (obj.event === 'over') {
                    layer.open({
                        type: 2,
                        title: "结束服务",
                        skin: 'layui-layer-rim',
                        area: area,
                        offset: 'auto',
                        skin: 'layerdemo',
                        resize: false,
                        content: "./overAfterSale.html",
                        success: function(layero, index) {
                            var data = obj.data;
                            var iframe = window['layui-layer-iframe' + index];
                            iframe.child(data);
                            var roleId = layer.getChildFrame("#afterSaleServiceCategory", index);
                            roleId.val(obj.data.afterSaleServiceCategory);
                            var roleId = layer.getChildFrame("#afterSaleServiceTopic", index);
                            roleId.val(obj.data.afterSaleServiceTopic);
                            var roleId = layer.getChildFrame("#departmentName", index);
                            roleId.val(obj.data.departmentName);
                            var roleId = layer.getChildFrame("#productName", index);
                            roleId.val(obj.data.productName);
                            var roleId = layer.getChildFrame("#customerName", index);
                            roleId.val(obj.data.customerName);
                            var roleId = layer.getChildFrame("#userName", index);
                            roleId.val(obj.data.userName);
                            var roleId = layer.getChildFrame("#contacts", index);
                            roleId.val(obj.data.contacts);
                            var roleId = layer.getChildFrame("#contactNum", index);
                            roleId.val(obj.data.contactNum);
                        },
                        end: function() {
                            table.reload("afterSaleTable", {
                                page: {
                                    curr: $("#afterSaleTable .layui-laypage-em").next().html()
                                },
                                url: selectAfterSalesInformationUrl(),
                                method: "post",
                                contentType: 'application/json; charset=utf-8',
                                where: {
                                    isPage: true
                                },
                                done: function(res, curr, count) {}
                            });
                        }
                    });
                } else if (obj.event === 'detail' && obj.data.processingStatus == "未处理") {
                    layer.open({
                        type: 2,
                        title: "查看服务详情",
                        skin: 'layui-layer-rim',
                        area: ['700px', '350px'],
                        offset: 'auto',
                        skin: 'layerdemo',
                        resize: false,
                        content: "./startafterSaleDetails.html",
                        success: function(layero, index) {
                            var data = obj.data;
                            var iframe = window['layui-layer-iframe' + index];
                            iframe.child(data);
                            var roleId = layer.getChildFrame("#afterSaleServiceCategory", index);
                            roleId.val(obj.data.afterSaleServiceCategory);
                            var roleId = layer.getChildFrame("#afterSaleServiceTopic", index);
                            roleId.val(obj.data.afterSaleServiceTopic);
                            var roleId = layer.getChildFrame("#departmentName", index);
                            roleId.val(obj.data.departmentName);
                            var roleId = layer.getChildFrame("#productName", index);
                            roleId.val(obj.data.productName);
                            var roleId = layer.getChildFrame("#customerName", index);
                            roleId.val(obj.data.customerName);
                            var roleId = layer.getChildFrame("#userName", index);
                            roleId.val(obj.data.userName);
                            var roleId = layer.getChildFrame("#contacts", index);
                            roleId.val(obj.data.contacts);
                            var roleId = layer.getChildFrame("#contactNum", index);
                            roleId.val(obj.data.contactNum);
                            var roleId = layer.getChildFrame("#chargeAmount", index);
                            roleId.val(obj.data.chargeAmount);
                            var roleId = layer.getChildFrame("#hotelExpense", index);
                            roleId.val(obj.data.hotelExpense);
                            var roleId = layer.getChildFrame("#subsidyFee", index);
                            roleId.val(obj.data.subsidyFee);
                            var roleId = layer.getChildFrame("#travelExpenses", index);
                            roleId.val(obj.data.travelExpenses);
                            var roleId = layer.getChildFrame("#serviceStartTime", index);
                            roleId.val(obj.data.serviceStartTime);
                            var roleId = layer.getChildFrame("#serviceEndTime", index);
                            roleId.val(obj.data.serviceEndTime);
                            var roleId = layer.getChildFrame("#serviceContent", index);
                            roleId.val(obj.data.serviceContent);
                            var roleId = layer.getChildFrame("#serviceDescription", index);
                            roleId.val(obj.data.serviceDescription);
                        },
                        end: function() {

                        }
                    });
                } else if (obj.event === 'detail' && obj.data.processingStatus == "处理中") {
                    layer.open({
                        type: 2,
                        title: "查看服务详情",
                        skin: 'layui-layer-rim',
                        area: ['800px', '300px'],
                        offset: 'auto',
                        skin: 'layerdemo',
                        resize: false,
                        content: "./overafterSaleDetails.html",
                        success: function(layero, index) {
                            var data = obj.data;
                            var iframe = window['layui-layer-iframe' + index];
                            iframe.child(data);
                            var roleId = layer.getChildFrame("#afterSaleServiceCategory", index);
                            roleId.val(obj.data.afterSaleServiceCategory);
                            var roleId = layer.getChildFrame("#afterSaleServiceTopic", index);
                            roleId.val(obj.data.afterSaleServiceTopic);
                            var roleId = layer.getChildFrame("#departmentName", index);
                            roleId.val(obj.data.departmentName);
                            var roleId = layer.getChildFrame("#productName", index);
                            roleId.val(obj.data.productName);
                            var roleId = layer.getChildFrame("#customerName", index);
                            roleId.val(obj.data.customerName);
                            var roleId = layer.getChildFrame("#userName", index);
                            roleId.val(obj.data.userName);
                            var roleId = layer.getChildFrame("#contacts", index);
                            roleId.val(obj.data.contacts);
                            var roleId = layer.getChildFrame("#contactNum", index);
                            roleId.val(obj.data.contactNum);
                            var roleId = layer.getChildFrame("#chargeAmount", index);
                            roleId.val(obj.data.chargeAmount);
                            var roleId = layer.getChildFrame("#hotelExpense", index);
                            roleId.val(obj.data.hotelExpense);
                            var roleId = layer.getChildFrame("#subsidyFee", index);
                            roleId.val(obj.data.subsidyFee);
                            var roleId = layer.getChildFrame("#travelExpenses", index);
                            roleId.val(obj.data.travelExpenses);
                            var roleId = layer.getChildFrame("#serviceStartTime", index);
                            roleId.val(obj.data.serviceStartTime);
                            var roleId = layer.getChildFrame("#serviceEndTime", index);
                            roleId.val(obj.data.serviceEndTime);
                            var roleId = layer.getChildFrame("#serviceContent", index);
                            roleId.val(obj.data.serviceContent);
                            var roleId = layer.getChildFrame("#serviceDescription", index);
                            roleId.val(obj.data.serviceDescription);
                        },
                        end: function() {

                        }
                    });
                } else if (obj.event === 'detail' && obj.data.processingStatus == "已完成") {
                    layer.open({
                        type: 2,
                        title: "查看服务详情",
                        skin: 'layui-layer-rim',
                        area: ['70%', '90%'],
                        offset: 'auto',
                        skin: 'layerdemo',
                        resize: false,
                        content: "./afterSaleDetails.html",
                        success: function(layero, index) {
                            var data = obj.data;
                            var iframe = window['layui-layer-iframe' + index];
                            iframe.child(data);
                            var roleId = layer.getChildFrame("#afterSaleServiceCategory", index);
                            roleId.val(obj.data.afterSaleServiceCategory);
                            var roleId = layer.getChildFrame("#afterSaleServiceTopic", index);
                            roleId.val(obj.data.afterSaleServiceTopic);
                            var roleId = layer.getChildFrame("#departmentName", index);
                            roleId.val(obj.data.departmentName);
                            var roleId = layer.getChildFrame("#productName", index);
                            roleId.val(obj.data.productName);
                            var roleId = layer.getChildFrame("#customerName", index);
                            roleId.val(obj.data.customerName);
                            var roleId = layer.getChildFrame("#userName", index);
                            roleId.val(obj.data.userName);
                            var roleId = layer.getChildFrame("#contacts", index);
                            roleId.val(obj.data.contacts);
                            var roleId = layer.getChildFrame("#contactNum", index);
                            roleId.val(obj.data.contactNum);
                            var roleId = layer.getChildFrame("#chargeAmount", index);
                            roleId.val(obj.data.chargeAmount);
                            var roleId = layer.getChildFrame("#hotelExpense", index);
                            roleId.val(obj.data.hotelExpense);
                            var roleId = layer.getChildFrame("#subsidyFee", index);
                            roleId.val(obj.data.subsidyFee);
                            var roleId = layer.getChildFrame("#travelExpenses", index);
                            roleId.val(obj.data.travelExpenses);
                            var roleId = layer.getChildFrame("#serviceStartTime", index);
                            roleId.val(obj.data.serviceStartTime);
                            var roleId = layer.getChildFrame("#serviceEndTime", index);
                            roleId.val(obj.data.serviceEndTime);
                            var roleId = layer.getChildFrame("#serviceContent", index);
                            roleId.val(obj.data.serviceContent);
                            var roleId = layer.getChildFrame("#serviceDescription", index);
                            roleId.val(obj.data.serviceDescription);
                        },
                        end: function() {

                        }
                    });
                } else if (obj.event === 'del') {
                    doDel4(obj);
                }
            });
            /* 删除产品*/
            function doDel4(mData) {
                layer.confirm('确定要删除选中的服务吗？', function(index) {
                    $.ajax({
                        url: deleteAfterSalesUrl(),
                        type: "post",
                        dataType: "json",
                        contentType: 'application/json; charset=utf-8',
                        async: false,
                        data: JSON.stringify({
                            "id": mData.data.id,
                            "operatorId": operatorId
                        }),
                        success: function(result) {
                            if (result.code == 0) {
                                layer.msg(result.msg, {
                                    icon: 1
                                });
                                mData.del();
                                layer.close(index);
                                table.reload("afterSaleTable", {
                                    page: {
                                        curr: $("#afterSaleTable .layui-laypage-em").next().html()
                                    },
                                    url: selectAfterSalesInformationUrl(),
                                    method: "post",
                                    contentType: 'application/json; charset=utf-8',
                                    where: {
                                        "afterSaleServiceTopic": '',
                                        "afterSaleServiceCategory": '',
                                        "processingStatus": '',
                                        "customerId": '',
                                        "serviceProcessingPersonnelId": '',
                                        "serviceStartTime": '',
                                        "serviceEndTime": '',
                                    },
                                    done: function(res, curr, count) {}
                                });
                            } else {
                                layer.msg(result.msg, {
                                    icon: 2
                                });
                            }
                        },
                        error: function() {
                            alert("服务器忙……请稍后重试！");
                        }
                    });
                });
            }
            // 客户初始化
            $.ajax({
                    url: initAfterSalesCustomersUrl(),
                    type: 'post',
                    contentType: "application/json",
                    data: JSON.stringify({
                        "customerName": ''
                    }),
                    success: function(result) {
                        $.each(result.data, function(index, item) {
                            $('#customerId').append(new Option(item.customerName, item.customerId));
                        });
                        form.render();
                    }
                })
                // 处理人员初始化
            $.ajax({
                url: getAllUserUrl(),
                type: 'post',
                contentType: "application/json",
                data: JSON.stringify({
                    "userName": '',
                    "sex": '',
                    'isPage': false,
                }),
                success: function(result) {
                    $.each(result.data, function(index, item) {
                        $('#processing').append(new Option(item.userName, item.userId));
                    });
                    form.render();
                }
            })

        });
    </script>
</body>

</html>